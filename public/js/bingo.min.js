let sheetData;Echo.channel("quiz").listen(".bingo",a=>{showSheet(a,sheetData)}),window.onload=function(){let a=window.location.href,b=new URL(a),c=b.searchParams.get("sheet");jQuery.ajax({url:"https://ehuquizsociety.com/api/bingo/sheet/"+c}).then(function(a){sheetData=a,showSheet(null,a)}).fail(function(a){console.error(a)})};const bingoFont=new FontFace("bingo","url(/fonts/bingo.ttf)");bingoFont.load().then(a=>{document.fonts.add(a)});const sundayFont=new FontFace("sunday","url(/fonts/sunday.ttf)");function showSheet(a,e){let b=window.location.href,c=new URL(b),d=0;d=a?parseInt(a.lines):parseInt(c.searchParams.get("line")),jQuery.ajax({url:"https://ehuquizsociety.com/api/bingo/"}).then(function(c){if(d){for(let a=0;a<6;a++)e[a].away=calculateAway(e[a],c,d);e.sort(function(a,b){return a.away-b.away})}let f=document.getElementById("bingo-canvas").getContext("2d"),b=new Image;b.onload=()=>{f.drawImage(b,0,0);let g=38,h=63,m=20,n=192;for(let a=0;a<e.length;a++){f.font="20px sunday",f.fillStyle="white",f.fillText("Sheet: "+e[a].sheet,50,m),f.fillText("Code: "+e[a].code,350,m),m+=201;let i=0;for(let j=0;j<e[a].data.one.length;j++)insertNumber(f,c,e[a].data.one[j],g,h),g+=49,e[a].data.one[j]&&1===c[e[a].data.one[j]-1].called&&5== ++i&&drawCompleteLineIndicator(f,30,h);g=38,h+=50,i=0;for(let k=0;k<e[a].data.two.length;k++)insertNumber(f,c,e[a].data.two[k],g,h),g+=49,e[a].data.two[k]&&1===c[e[a].data.two[k]-1].called&&5== ++i&&drawCompleteLineIndicator(f,30,h);g=38,h+=50,i=0;for(let l=0;l<e[a].data.three.length;l++)insertNumber(f,c,e[a].data.three[l],g,h),g+=49,e[a].data.three[l]&&1===c[e[a].data.three[l]-1].called&&5== ++i&&drawCompleteLineIndicator(f,30,h);d&&awayCounter(f,e[a].away,n),n+=201,g=38,h+=101}},b.src="/images/BingoSheetBackground.png"})}function insertNumber(a,e,b,c,d){b&&1===e[b-1].called&&(a.beginPath(),a.arc(c+16,d-12,20,0,360,!1),a.fillStyle="#90ee90",a.fill(),a.lineWidth=1,a.strokeStyle="#90ee90",a.stroke()),a.font="35px bingo",a.fillStyle="black",null!=b&&(b>9?a.fillText(b,c,d):a.fillText(b,c+5,d))}function awayCounter(a,b,c){a.font="20px sunday",a.fillStyle="white",a.fillText(b+" away",200,c)}function calculateAway(b,f,g){let c=5,d=5,e=5;for(let a=0;a<16;a++)b.data.one[a]&&1===f[b.data.one[a]-1].called&&c--,b.data.two[a]&&1===f[b.data.two[a]-1].called&&d--,b.data.three[a]&&1===f[b.data.three[a]-1].called&&e--;if(1===g)return Math.min(...[c,d,e]);if(2===g){let h=[c,d,e];return h.sort(function(a,b){return a-b}),Math.min(...[c,d,e])+h[1]}return 15-(15-c-d-e)}function drawCompleteLineIndicator(a,b,c){a.beginPath(),a.rect(b,c-32,440,40),a.fillStyle="rgba(128, 128, 128, 0.5)",a.fill(),a.lineWidth=1,a.strokeStyle="#808080",a.opacity=.5,a.stroke()}sundayFont.load().then(a=>{document.fonts.add(a)})
